window.onload=function(s){smash.init()};var smash={};smash.init=function(){smash.config.init(),smash.sidebar.init(),smash.searchbox.init(),smash.workspace.init(),smash.input.init()},smash.get=function(s,e){try{return s.querySelector(e)}catch(s){console.log(s)}},smash.getAll=function(s,e){try{return s.querySelectorAll(e)}catch(s){console.log(s)}},smash.hide=function(s,e){for(var a=smash.getAll(s,e),t=0;t<a.length;t++)a[t].style.display="none"},smash.show=function(s,e){for(var a=smash.getAll(s,e),t=0;t<a.length;t++)a[t].style.display=""},smash.on=function(s,e,a,t){for(var n=smash.getAll(s,e),o=0;o<n.length;o++)n[o][a]=t},smash.ajax={},smash.ajax.x=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(var s,e=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],a=0;a<e.length;a++)try{s=new ActiveXObject(e[a]);break}catch(s){}return s},smash.ajax.send=function(s,e,a,t,n,o){void 0===o&&(o=!0);var r=smash.ajax.x();r.responseType=n,r.open(a,s,o),r.onreadystatechange=function(){4==r.readyState&&(200==r.status||201==r.status?e&&e(r.response):console.log(r.status,r.response))},"POST"==a&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(t)},smash.ajax.get=function(s,e,a,t,n){var o=[];for(var r in a)o.push(encodeURIComponent(r)+"="+encodeURIComponent(a[r]));smash.ajax.send(s+(o.length?"?"+o.join("&"):""),e,"GET",null,t,n)},smash.ajax.post=function(s,e,a,t,n){var o;if(a)if("json"!=t){var r=[];for(var i in a)r.push(encodeURIComponent(i)+"="+encodeURIComponent(a[i]));o=r.join("&")}else o=JSON.stringify(a);smash.ajax.send(s,e,"POST",o,t,n)},smash.class={},smash.class.add=function(s,e){smash.class.has(s,e)||(s.classList?s.classList.add(e):s.className+=" "+e)},smash.class.remove=function(s,e){smash.class.has(s,e)&&(s.classList?s.classList.remove(e):s.className=s.className.replace(e,""))},smash.class.has=function(s,e){return(" "+s.className+" ").replace(/[\n\t]/g," ").indexOf(" "+e+" ")>-1},smash.class.toggle=function(s,e){smash.class.has(s,e)?smash.class.remove(s,e):smash.class.add(s,e)},smash.config={_values_:{_sidebar_lock_:!1}},smash.config.init=function(){var s=smash.storage.get("config");s&&(smash.config._values_=s)},smash.config.get=function(s){var e="_"+s+"_";if(e in smash.config._values_)return smash.config._values_[e];throw new smash.Exception("001",'Invalid config option "'+s+'"')},smash.config.set=function(s,e){var a="_"+s+"_";if(!a in smash.config._values_)throw new smash.Exception("001",'Invalid config option "'+s+'"');smash.config._values_[a]=e,smash.storage.set("config",smash.config._values_)},smash.Exception=function(s,e){this.value=s,this.message=e,this.toString=function(){return"SmashException "+this.value+": "+this.message}},smash.input={},smash.input.init=function(){for(var s,e=document.querySelectorAll(".smash-input.has-floating-label input"),a=0;a<e.length;a++){s=e[a],smash.class.remove(s.parentElement,"has-floating-label"),smash.class.add(s.parentElement,"floating-label");var t=document.createElement("label");t.innerHTML=s.placeholder,s.parentElement.appendChild(t),s.onkeyup=function(s){var e=this.parentElement.querySelector("label");e&&(""!=s.srcElement.value?smash.class.add(e,"show"):smash.class.remove(e,"show"))}}for(var n,o=document.querySelectorAll(".smash-select select"),a=0;a<o.length;a++){if(n=o[a],smash.class.has(n.parentElement,"has-floating-label")){smash.class.remove(n.parentElement,"has-floating-label"),smash.class.add(n.parentElement,"floating-label");var t=document.createElement("label");t.innerHTML=n.getAttribute("placeholder"),n.parentElement.appendChild(t)}var s=document.createElement("input");s.type="text",s.placeholder=n.getAttribute("placeholder"),s.setAttribute("readonly","readonly"),n.parentElement.appendChild(s);for(var r=n.querySelectorAll("option"),i=document.createElement("ul"),c=0;c<r.length;c++){var h=r[c];if(h.getAttribute("value")){var m=document.createElement("li");m.setAttribute("value",h.value),m.innerHTML=h.innerHTML,i.appendChild(m),m.onmousedown=function(s){var e=this.getAttribute("value"),a=this.parentElement.parentElement;smash.class.remove(a,"is-focussed"),window.onmousedown=null,a.querySelector("select").value=e,a.querySelector("input").value=this.innerHTML,a.querySelector("input").focus(),a.querySelector("input").onfocus(),s.stopPropagation()}}}n.parentElement.appendChild(i),s.onfocus=function(s){var e=this.parentElement.querySelector("label");e&&(""!=this.value?smash.class.add(e,"show"):smash.class.remove(e,"show"))},n.parentElement.onclick=function(){smash.class.add(this,"is-focussed");var s=this;window.onmousedown=function(){console.log("click outside"),window.onmousedown=null,smash.class.remove(s,"is-focussed")}}}},smash.router={__parseRouteRegex:/{(.*?)}/gi,__dynamicParts:[],__routes:{static:[],dynamic:[]}},smash.router.add=function(s,e){var a=smash.router.parseRoute(s);return a.regex?(a.callback=e,smash.router.__routes.dynamic[a.depth]||(smash.router.__routes.dynamic[a.depth]=[]),smash.router.__routes.dynamic[a.depth][a.numVars]||(smash.router.__routes.dynamic[a.depth][a.numVars]=[]),void smash.router.__routes.dynamic[a.depth][a.numVars].push(a)):void(smash.router.__routes.static[s]=e)},smash.router.set=function(s){window.history.pushState("","",s),window.dispatchEvent(new Event("popstate"))},smash.router.redirect=function(s){window.location=s},smash.router.handleNotFound=function(s){console.log("route: "+JSON.stringify(s)+" does not exist")},smash.router.run=function(){window.onpopstate=function(s){smash.router.execute()},smash.router.execute()},smash.router.execute=function(){var s=this.getPath();if(this.__routes.static[s.path])return void this.__routes.static[s.path]();var e=s.path.split("/").length-1;if(this.__routes.dynamic[e]){var a,t,n={};for(var o in this.__routes.dynamic[e])for(var r in this.__routes.dynamic[e][o]){var a=this.__routes.dynamic[e][o][r];if(t=s.path.match(a.regex)){for(var i=0;i<a.numVars;i++)n[a.vars[i]]=t[i+1];return void a.callback(n)}}}smash.router.handleNotFound(s)},smash.router.getPath=function(){var s=document.createElement("a");return s.href=window.location,{host:s.hostname,path:s.pathname}},smash.router.parseRoute=function(s){"/"!=s.substring(0,1)&&(s="/"+s),"/"==s.substring(s.length-2)&&(s="/"+s);var e={path:s,depth:s.split("/").length-1,vars:[],numVars:0};if(smash.router.__dynamicParts=s.match(smash.router.__parseRouteRegex),void 0!=smash.router.__dynamicParts&&null!=smash.router.__dynamicParts){for(var a="^"+s.replace(/\//gi,"\\/")+"$",t=0;t<smash.router.__dynamicParts.length;t++)e.numVars++,e.vars.push(smash.router.__dynamicParts[t].substring(1,smash.router.__dynamicParts[t].length-1)),a=a.replace(smash.router.__dynamicParts[t],"(.*?)");e.regex=new RegExp(a,"i")}return e},smash.searchbox={i_:!1},smash.searchbox.init=function(){if(!smash.searchbox.i_){var s=document.querySelector(".smash-searchbox input");s&&(s.onfocus=function(){smash.class.add(document.querySelector(".smash-header"),"is-focussed")},s.onblur=function(){smash.class.remove(document.querySelector(".smash-header"),"is-focussed")}),smash.searchbox.i_=!0}},smash.sidebar={i_:!1},smash.sidebar.init=function(){if(!smash.sidebar.i_){var s=document.querySelector(".smash-sidebar .lock");if(s){s.onclick=function(){smash.sidebar.toggleLock()};var e=document.querySelector(".smash-sidebar");smash.class.add(e,"is-unlocked"),smash.sidebar.i_=!0,smash.config.get("sidebar_lock")&&smash.sidebar.toggleLock()}}},smash.sidebar.toggleLock=function(){smash.sidebar.i_&&(smash.class.toggle(document.querySelector(".smash-sidebar .lock"),"unlock"),smash.class.toggle(document.querySelector(".smash-sidebar"),"is-unlocked"),smash.config.set("sidebar_lock",!smash.class.has(document.querySelector(".smash-sidebar"),"is-unlocked")))},smash.storage={},smash.storage.set=function(s,e){localStorage.setItem(s,JSON.stringify(e))},smash.storage.get=function(s){var e=localStorage.getItem(s);if(e)return JSON.parse(e)},smash.storage.clear=function(){localStorage.clear()},smash.workspace={_ws_:void 0,_hdr_:void 0,_sb_:void 0,_tabs_:[]},smash.workspace.init=function(){smash.workspace._ws_=document.querySelector(".smash-workspace"),smash.workspace._ws_&&(smash.workspace._hdr_=document.querySelector(".smash-header"),smash.workspace._hdr_&&smash.class.add(smash.workspace._ws_,"has-header"),smash.workspace._sb_=document.querySelector(".smash-workspace .smash-sidebar"),smash.workspace._sb_&&smash.class.add(smash.workspace._ws_,"has-sidebar"))},smash.workspace.addTab=function(s,e,a){if(!smash.get(document,".smash-tab-pane")){var t=smash.get(document,".smash-panel");if(!t)return void console.log("To add a tab there needs to be a panel");t.innerHTML='<div class="smash-tab-pane"><div class="smash-tabs"></div><div class="smash-panes"></div></div>'}var n=smash.get(document,".smash-tab-pane .smash-tabs"),o=smash.get(document,".smash-tab-pane .smash-panes");smash.hide(o,".smash-pane"),(active=smash.get(n,".smash-tab.active"))&&smash.class.remove(active,"active"),n.innerHTML=n.innerHTML+'<div class="smash-tab active" data-id="'+s+'">'+e+'<i class="material-icons close">close</i></div>',o.innerHTML=o.innerHTML+'<div class="smash-pane" data-id="'+s+'">'+a+"</div>",smash.on(n,".smash-tab","onclick",function(s){console.log("test"),(active=smash.get(n,".smash-tab.active"))&&smash.class.remove(active,"active"),smash.class.add(this,"active")})};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNtYXNoLmpzIiwiYWpheC5qcyIsImNsYXNzLmpzIiwiY29uZmlnLmpzIiwiZXhjZXB0aW9uLmpzIiwiaW5wdXQuanMiLCJyb3V0ZXIuanMiLCJzZWFyY2hib3guanMiLCJzaWRlYmFyLmpzIiwic3RvcmFnZS5qcyIsIndvcmtzcGFjZS5qcyJdLCJuYW1lcyI6WyJ3aW5kb3ciLCJvbmxvYWQiLCJlIiwic21hc2giLCJpbml0IiwiY29uZmlnIiwic2lkZWJhciIsInNlYXJjaGJveCIsIndvcmtzcGFjZSIsImlucHV0IiwiZ2V0IiwicGFyZW50Iiwic2VsZWN0b3IiLCJxdWVyeVNlbGVjdG9yIiwiY29uc29sZSIsImxvZyIsImdldEFsbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJoaWRlIiwiZWwiLCJpIiwibGVuZ3RoIiwic3R5bGUiLCJkaXNwbGF5Iiwic2hvdyIsIm9uIiwiZXZlbnQiLCJjYWxsYmFjayIsImVsZW1lbnRzIiwiYWpheCIsIngiLCJYTUxIdHRwUmVxdWVzdCIsInhociIsInZlcnNpb25zIiwiQWN0aXZlWE9iamVjdCIsInNlbmQiLCJ1cmwiLCJtZXRob2QiLCJkYXRhIiwicmVzcG9uc2VUeXBlIiwiYXN5bmMiLCJ1bmRlZmluZWQiLCJvcGVuIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsInJlc3BvbnNlIiwic2V0UmVxdWVzdEhlYWRlciIsInF1ZXJ5Iiwia2V5IiwicHVzaCIsImVuY29kZVVSSUNvbXBvbmVudCIsImpvaW4iLCJwb3N0IiwiZGF0YVN0ciIsIkpTT04iLCJzdHJpbmdpZnkiLCJjbGFzcyIsImFkZCIsImNsYXNzTmFtZSIsImhhcyIsImNsYXNzTGlzdCIsInJlbW92ZSIsInJlcGxhY2UiLCJpbmRleE9mIiwidG9nZ2xlIiwiX3ZhbHVlc18iLCJfc2lkZWJhcl9sb2NrXyIsInYiLCJzdG9yYWdlIiwib3B0aW9uIiwibyIsIkV4Y2VwdGlvbiIsInNldCIsInZhbHVlIiwibWVzc2FnZSIsInRoaXMiLCJ0b1N0cmluZyIsImlucHV0cyIsImRvY3VtZW50IiwicGFyZW50RWxlbWVudCIsImxhYmVsIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInBsYWNlaG9sZGVyIiwiYXBwZW5kQ2hpbGQiLCJvbmtleXVwIiwibCIsInNyY0VsZW1lbnQiLCJzZWxlY3QiLCJzZWxlY3RzIiwiZ2V0QXR0cmlidXRlIiwidHlwZSIsInNldEF0dHJpYnV0ZSIsIm9wdGlvbnMiLCJ1bCIsImoiLCJsaSIsIm9ubW91c2Vkb3duIiwidmFsIiwiZm9jdXMiLCJvbmZvY3VzIiwic3RvcFByb3BhZ2F0aW9uIiwib25jbGljayIsInJvdXRlciIsIl9fcGFyc2VSb3V0ZVJlZ2V4IiwiX19keW5hbWljUGFydHMiLCJfX3JvdXRlcyIsInN0YXRpYyIsImR5bmFtaWMiLCJwYXRoIiwicm91dGUiLCJwYXJzZVJvdXRlIiwicmVnZXgiLCJkZXB0aCIsIm51bVZhcnMiLCJoaXN0b3J5IiwicHVzaFN0YXRlIiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50IiwicmVkaXJlY3QiLCJsb2NhdGlvbiIsImhhbmRsZU5vdEZvdW5kIiwicnVuIiwib25wb3BzdGF0ZSIsImV4ZWN1dGUiLCJnZXRQYXRoIiwic3BsaXQiLCJtYXRjaGVzIiwidmFyTnVtIiwiaXRlbSIsIm1hdGNoIiwidmFycyIsImhyZWYiLCJob3N0IiwiaG9zdG5hbWUiLCJwYXRobmFtZSIsInN1YnN0cmluZyIsIlJlZ0V4cCIsImlfIiwic3NiIiwib25ibHVyIiwic2libCIsInRvZ2dsZUxvY2siLCJzaWIiLCJuYW1lIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsImdldEl0ZW0iLCJwYXJzZSIsImNsZWFyIiwiX3dzXyIsIl9oZHJfIiwiX3NiXyIsIl90YWJzXyIsImFkZFRhYiIsImlkIiwidGl0bGUiLCJjb250ZW50IiwicGFuZWwiLCJ0YWJzIiwicGFuZXNDb250YWluZXIiLCJhY3RpdmUiXSwibWFwcGluZ3MiOiJBQUFBQSxPQUFBQyxPQUFBLFNBQUFDLEdBQ0FDLE1BQUFD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QUFBdkQsTUFBQUssVUFBQStJLEtBQUEsY0FFQXBKLE1BQUFLLFVBQUFpSixLQUFBMUUsU0FBQWxFLGNBQUEsbUNBQ0FWLE1BQUFLLFVBQUFpSixNQUNBdEosTUFBQXNELE1BQUFDLElBQUF2RCxNQUFBSyxVQUFBK0ksS0FBQSxpQkFJQXBKLE1BQUFLLFVBQUFtSixPQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQ0EsSUFBQTNKLE1BQUFPLElBQUFxRSxTQUFBLG1CQUFBLENBQ0EsR0FBQWdGLEdBQUE1SixNQUFBTyxJQUFBcUUsU0FBQSxlQUNBLEtBQUFnRixFQUVBLFdBREFqSixTQUFBQyxJQUFBLHlDQUdBZ0osR0FBQTVFLFVBQUEsa0dBRUEsR0FBQTZFLEdBQUE3SixNQUFBTyxJQUFBcUUsU0FBQSwrQkFDQWtGLEVBQUE5SixNQUFBTyxJQUFBcUUsU0FBQSwrQkFFQTVFLE9BQUFlLEtBQUErSSxFQUFBLGdCQUNBQyxPQUFBL0osTUFBQU8sSUFBQXNKLEVBQUEsdUJBQ0E3SixNQUFBc0QsTUFBQUssT0FBQW9HLE9BQUEsVUFFQUYsRUFBQTdFLFVBQUE2RSxFQUFBN0UsVUFBQSwwQ0FBQXlFLEVBQUEsS0FBQUMsRUFBQSxrREFDQUksRUFBQTlFLFVBQUE4RSxFQUFBOUUsVUFBQSxvQ0FBQXlFLEVBQUEsS0FBQUUsRUFBQSxTQUNBM0osTUFBQXNCLEdBQUF1SSxFQUFBLGFBQUEsVUFBQSxTQUFBOUosR0FDQVksUUFBQUMsSUFBQSxTQUNBbUosT0FBQS9KLE1BQUFPLElBQUFzSixFQUFBLHVCQUNBN0osTUFBQXNELE1BQUFLLE9BQUFvRyxPQUFBLFVBRUEvSixNQUFBc0QsTUFBQUMsSUFBQWtCLEtBQUEiLCJmaWxlIjoic21hc2guanMiLCJzb3VyY2VzQ29udGVudCI6WyJ3aW5kb3cub25sb2FkID0gZnVuY3Rpb24oZSl7XG4gICAgc21hc2guaW5pdCgpO1xufVxuXG52YXIgc21hc2ggPSB7fTtcblxuc21hc2guaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHNtYXNoLmNvbmZpZy5pbml0KCk7XG4gICAgc21hc2guc2lkZWJhci5pbml0KCk7XG4gICAgc21hc2guc2VhcmNoYm94LmluaXQoKTtcbiAgICBzbWFzaC53b3Jrc3BhY2UuaW5pdCgpO1xuICAgIHNtYXNoLmlucHV0LmluaXQoKTtcbn07XG5cbnNtYXNoLmdldCA9IGZ1bmN0aW9uKHBhcmVudCwgc2VsZWN0b3IpIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gcGFyZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xuICAgIH0gY2F0Y2goZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cbnNtYXNoLmdldEFsbCA9IGZ1bmN0aW9uKHBhcmVudCwgc2VsZWN0b3IpIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gcGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xuICAgIH0gY2F0Y2goZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cbnNtYXNoLmhpZGUgPSBmdW5jdGlvbihwYXJlbnQsIHNlbGVjdG9yKSB7XG4gICAgdmFyIGVsID0gc21hc2guZ2V0QWxsKHBhcmVudCwgc2VsZWN0b3IpO1xuICAgIGZvciAodmFyIGk9MDsgaTxlbC5sZW5ndGg7IGkrKykge1xuICAgICAgICBlbFtpXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIH1cbn07XG5cbnNtYXNoLnNob3cgPSBmdW5jdGlvbihwYXJlbnQsIHNlbGVjdG9yKSB7XG4gICAgdmFyIGVsID0gc21hc2guZ2V0QWxsKHBhcmVudCwgc2VsZWN0b3IpO1xuICAgIGZvciAodmFyIGk9MDsgaTxlbC5sZW5ndGg7IGkrKykge1xuICAgICAgICBlbFtpXS5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgfVxufTtcblxuc21hc2gub24gPSBmdW5jdGlvbihwYXJlbnQsIHNlbGVjdG9yLCBldmVudCwgY2FsbGJhY2spIHtcbiAgICB2YXIgZWxlbWVudHMgPSBzbWFzaC5nZXRBbGwocGFyZW50LCBzZWxlY3Rvcik7XG4gICAgZm9yICh2YXIgaT0wOyBpPGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGVsZW1lbnRzW2ldW2V2ZW50XSA9IGNhbGxiYWNrO1xuICAgIH1cbn1cbiIsInNtYXNoLmFqYXggPSB7fTtcblxuc21hc2guYWpheC54ID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0eXBlb2YgWE1MSHR0cFJlcXVlc3QgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICB9XG4gICAgdmFyIHZlcnNpb25zID0gW1xuICAgICAgICBcIk1TWE1MMi5YbWxIdHRwLjYuMFwiLFxuICAgICAgICBcIk1TWE1MMi5YbWxIdHRwLjUuMFwiLFxuICAgICAgICBcIk1TWE1MMi5YbWxIdHRwLjQuMFwiLFxuICAgICAgICBcIk1TWE1MMi5YbWxIdHRwLjMuMFwiLFxuICAgICAgICBcIk1TWE1MMi5YbWxIdHRwLjIuMFwiLFxuICAgICAgICBcIk1pY3Jvc29mdC5YbWxIdHRwXCJcbiAgICBdO1xuICAgIHZhciB4aHI7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2ZXJzaW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgeGhyID0gbmV3IEFjdGl2ZVhPYmplY3QodmVyc2lvbnNbaV0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4geGhyO1xufTtcblxuc21hc2guYWpheC5zZW5kID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2ssIG1ldGhvZCwgZGF0YSwgcmVzcG9uc2VUeXBlLCBhc3luYykge1xuICAgIGlmIChhc3luYyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGFzeW5jID0gdHJ1ZTtcbiAgICB9XG4gICAgdmFyIHggPSBzbWFzaC5hamF4LngoKTtcbiAgICB4LnJlc3BvbnNlVHlwZSA9IHJlc3BvbnNlVHlwZTtcbiAgICB4Lm9wZW4obWV0aG9kLCB1cmwsIGFzeW5jKTtcbiAgICB4Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAoeC5yZWFkeVN0YXRlID09IDQpIHtcblx0XHRcdGlmICh4LnN0YXR1cyA9PSAyMDAgfHwgeC5zdGF0dXMgPT0gMjAxKSB7XG5cdFx0XHRcdGNhbGxiYWNrICYmIGNhbGxiYWNrKHgucmVzcG9uc2UpO1xuXHRcdFx0fSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh4LnN0YXR1cywgeC5yZXNwb25zZSk7XG5cdFx0XHR9XG5cdFx0fVxuICAgIH07XG4gICAgaWYgKG1ldGhvZCA9PSAnUE9TVCcpIHtcbiAgICAgICAgeC5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyk7XG4gICAgfVxuICAgIHguc2VuZChkYXRhKVxufTtcblxuc21hc2guYWpheC5nZXQgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaywgZGF0YSwgcmVzcG9uc2VUeXBlLCBhc3luYykge1xuICAgIHZhciBxdWVyeSA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBkYXRhKSB7XG4gICAgICAgIHF1ZXJ5LnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoZGF0YVtrZXldKSk7XG4gICAgfVxuICAgIHNtYXNoLmFqYXguc2VuZCh1cmwgKyAocXVlcnkubGVuZ3RoID8gJz8nICsgcXVlcnkuam9pbignJicpIDogJycpLCBjYWxsYmFjaywgJ0dFVCcsIG51bGwsIHJlc3BvbnNlVHlwZSwgIGFzeW5jKVxufTtcblxuc21hc2guYWpheC5wb3N0ID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2ssIGRhdGEsIHJlc3BvbnNlVHlwZSwgYXN5bmMpIHtcbiAgICB2YXIgZGF0YVN0cjtcbiAgICBpZiAoZGF0YSkge1xuICAgICAgICBpZiAocmVzcG9uc2VUeXBlICE9ICdqc29uJykge1xuICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gW107XG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gZGF0YSkge1xuICAgICAgICAgICAgICAgIHF1ZXJ5LnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoZGF0YVtrZXldKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkYXRhU3RyID0gcXVlcnkuam9pbignJicpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkYXRhU3RyID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc21hc2guYWpheC5zZW5kKHVybCwgY2FsbGJhY2ssICdQT1NUJywgZGF0YVN0ciwgcmVzcG9uc2VUeXBlLCBhc3luYylcbn07XG4iLCJzbWFzaC5jbGFzcyA9IHt9O1xuXG5zbWFzaC5jbGFzcy5hZGQgPSBmdW5jdGlvbihlbCwgY2xhc3NOYW1lKSB7XG4gICAgaWYgKCFzbWFzaC5jbGFzcy5oYXMoZWwsIGNsYXNzTmFtZSkpIHtcbiAgICAgICAgZWwuY2xhc3NMaXN0ID8gZWwuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpIDogZWwuY2xhc3NOYW1lICs9ICgnICcgKyBjbGFzc05hbWUpO1xuICAgIH1cbn07XG5cbnNtYXNoLmNsYXNzLnJlbW92ZSA9IGZ1bmN0aW9uKGVsLCBjbGFzc05hbWUpIHtcbiAgICBpZiAoc21hc2guY2xhc3MuaGFzKGVsLCBjbGFzc05hbWUpKSB7XG4gICAgICAgIGVsLmNsYXNzTGlzdCA/IGVsLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKSA6IGVsLmNsYXNzTmFtZSA9IGVsLmNsYXNzTmFtZS5yZXBsYWNlKGNsYXNzTmFtZSwgJycpO1xuICAgIH1cbn07XG5cbnNtYXNoLmNsYXNzLmhhcyA9IGZ1bmN0aW9uKGVsLCBjbGFzc05hbWUpIHtcbiAgICByZXR1cm4gKChcIiBcIiArIGVsLmNsYXNzTmFtZSArIFwiIFwiKS5yZXBsYWNlKC9bXFxuXFx0XS9nLCBcIiBcIikuaW5kZXhPZihcIiBcIiArIGNsYXNzTmFtZSArIFwiIFwiKSA+IC0xKTtcbn07XG5cbnNtYXNoLmNsYXNzLnRvZ2dsZSA9IGZ1bmN0aW9uKGVsLCBjbGFzc05hbWUpIHtcbiAgICBzbWFzaC5jbGFzcy5oYXMoZWwsIGNsYXNzTmFtZSkgPyBzbWFzaC5jbGFzcy5yZW1vdmUoZWwsIGNsYXNzTmFtZSkgOiBzbWFzaC5jbGFzcy5hZGQoZWwsIGNsYXNzTmFtZSk7XG59O1xuIiwic21hc2guY29uZmlnID0ge1xuICAgIF92YWx1ZXNfOiB7XG4gICAgICAgIF9zaWRlYmFyX2xvY2tfOiBmYWxzZVxuICAgIH1cbn1cblxuc21hc2guY29uZmlnLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgdiA9IHNtYXNoLnN0b3JhZ2UuZ2V0KCdjb25maWcnKTtcbiAgICBpZiAodikge1xuICAgICAgICBzbWFzaC5jb25maWcuX3ZhbHVlc18gPSB2O1xuICAgIH1cbn07XG5cbnNtYXNoLmNvbmZpZy5nZXQgPSBmdW5jdGlvbihvcHRpb24pIHtcbiAgICB2YXIgbyA9ICdfJyArIG9wdGlvbiArICdfJztcbiAgICBpZiAobyBpbiBzbWFzaC5jb25maWcuX3ZhbHVlc18pIHtcbiAgICAgICAgcmV0dXJuIHNtYXNoLmNvbmZpZy5fdmFsdWVzX1tvXTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IHNtYXNoLkV4Y2VwdGlvbignMDAxJywgJ0ludmFsaWQgY29uZmlnIG9wdGlvbiBcIicgKyBvcHRpb24gKyAnXCInKTtcbn07XG5cbnNtYXNoLmNvbmZpZy5zZXQgPSBmdW5jdGlvbihvcHRpb24sIHZhbHVlKSB7XG4gICAgdmFyIG8gPSAnXycgKyBvcHRpb24gKyAnXyc7XG4gICAgaWYgKCFvIGluIHNtYXNoLmNvbmZpZy5fdmFsdWVzXykge1xuICAgICAgICB0aHJvdyBuZXcgc21hc2guRXhjZXB0aW9uKCcwMDEnLCAnSW52YWxpZCBjb25maWcgb3B0aW9uIFwiJyArIG9wdGlvbiArICdcIicpO1xuICAgIH1cbiAgICBzbWFzaC5jb25maWcuX3ZhbHVlc19bb10gPSB2YWx1ZTtcbiAgICBzbWFzaC5zdG9yYWdlLnNldCgnY29uZmlnJywgc21hc2guY29uZmlnLl92YWx1ZXNfKTtcbn07XG4iLCJzbWFzaC5FeGNlcHRpb24gPSBmdW5jdGlvbiAodmFsdWUsIG1lc3NhZ2UpIHtcbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICB0aGlzLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAnU21hc2hFeGNlcHRpb24gJyArIHRoaXMudmFsdWUgKyAnOiAnICsgdGhpcy5tZXNzYWdlO1xuICAgIH07XG59O1xuIiwic21hc2guaW5wdXQgPSB7fTtcblxuc21hc2guaW5wdXQuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNtYXNoLWlucHV0Lmhhcy1mbG9hdGluZy1sYWJlbCBpbnB1dFwiKTtcbiAgICB2YXIgaW5wdXQ7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaW5wdXQgPSBpbnB1dHNbaV07XG4gICAgICAgIHNtYXNoLmNsYXNzLnJlbW92ZShpbnB1dC5wYXJlbnRFbGVtZW50LCAnaGFzLWZsb2F0aW5nLWxhYmVsJyk7XG4gICAgICAgIHNtYXNoLmNsYXNzLmFkZChpbnB1dC5wYXJlbnRFbGVtZW50LCAnZmxvYXRpbmctbGFiZWwnKTtcblxuICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgICAgICBsYWJlbC5pbm5lckhUTUwgPSBpbnB1dC5wbGFjZWhvbGRlcjtcbiAgICAgICAgaW5wdXQucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChsYWJlbCk7XG4gICAgICAgIGlucHV0Lm9ua2V5dXAgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgbCA9IHRoaXMucGFyZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKFwibGFiZWxcIik7XG4gICAgICAgICAgICBpZiAobCkge1xuICAgICAgICAgICAgICAgIGlmIChlLnNyY0VsZW1lbnQudmFsdWUgIT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICBzbWFzaC5jbGFzcy5hZGQobCwgJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzbWFzaC5jbGFzcy5yZW1vdmUobCwgJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHZhciBzZWxlY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zbWFzaC1zZWxlY3Qgc2VsZWN0XCIpO1xuICAgIHZhciBzZWxlY3Q7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxlY3RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHNlbGVjdCA9IHNlbGVjdHNbaV07XG4gICAgICAgIGlmIChzbWFzaC5jbGFzcy5oYXMoc2VsZWN0LnBhcmVudEVsZW1lbnQsICdoYXMtZmxvYXRpbmctbGFiZWwnKSkge1xuICAgICAgICAgICAgc21hc2guY2xhc3MucmVtb3ZlKHNlbGVjdC5wYXJlbnRFbGVtZW50LCAnaGFzLWZsb2F0aW5nLWxhYmVsJyk7XG4gICAgICAgICAgICBzbWFzaC5jbGFzcy5hZGQoc2VsZWN0LnBhcmVudEVsZW1lbnQsICdmbG9hdGluZy1sYWJlbCcpO1xuICAgICAgICAgICAgdmFyIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICAgICAgICAgIGxhYmVsLmlubmVySFRNTCA9IHNlbGVjdC5nZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJyk7XG4gICAgICAgICAgICBzZWxlY3QucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChsYWJlbCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgICAgaW5wdXQudHlwZSA9IFwidGV4dFwiO1xuICAgICAgICBpbnB1dC5wbGFjZWhvbGRlciA9IHNlbGVjdC5nZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJyk7XG4gICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcInJlYWRvbmx5XCIsIFwicmVhZG9ubHlcIik7XG4gICAgICAgIHNlbGVjdC5wYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKGlucHV0KTtcblxuICAgICAgICB2YXIgb3B0aW9ucyA9IHNlbGVjdC5xdWVyeVNlbGVjdG9yQWxsKFwib3B0aW9uXCIpO1xuICAgICAgICB2YXIgdWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9wdGlvbnMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHZhciBvcHRpb24gPSBvcHRpb25zW2pdO1xuICAgICAgICAgICAgaWYgKG9wdGlvbi5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJykpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICAgICAgICAgICAgICAgIGxpLnNldEF0dHJpYnV0ZShcInZhbHVlXCIsIG9wdGlvbi52YWx1ZSk7XG4gICAgICAgICAgICAgICAgbGkuaW5uZXJIVE1MID0gb3B0aW9uLmlubmVySFRNTDtcbiAgICAgICAgICAgICAgICB1bC5hcHBlbmRDaGlsZChsaSk7XG4gICAgICAgICAgICAgICAgbGkub25tb3VzZWRvd24gPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWwgPSB0aGlzLmdldEF0dHJpYnV0ZSgndmFsdWUnKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICBzbWFzaC5jbGFzcy5yZW1vdmUocGFyZW50LCAnaXMtZm9jdXNzZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9ubW91c2Vkb3duID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnF1ZXJ5U2VsZWN0b3IoXCJzZWxlY3RcIikudmFsdWUgPSB2YWw7XG4gICAgICAgICAgICAgICAgICAgIHBhcmVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIikudmFsdWUgPSB0aGlzLmlubmVySFRNTDtcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFwiKS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICBwYXJlbnQucXVlcnlTZWxlY3RvcihcImlucHV0XCIpLm9uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2VsZWN0LnBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQodWwpO1xuICAgICAgICBpbnB1dC5vbmZvY3VzID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyIGwgPSB0aGlzLnBhcmVudEVsZW1lbnQucXVlcnlTZWxlY3RvcihcImxhYmVsXCIpO1xuICAgICAgICAgICAgaWYgKGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZSAhPSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHNtYXNoLmNsYXNzLmFkZChsLCAnc2hvdycpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNtYXNoLmNsYXNzLnJlbW92ZShsLCAnc2hvdycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBzZWxlY3QucGFyZW50RWxlbWVudC5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzbWFzaC5jbGFzcy5hZGQodGhpcywgJ2lzLWZvY3Vzc2VkJyk7XG4gICAgICAgICAgICB2YXIgc2VsZWN0ID0gdGhpcztcbiAgICAgICAgICAgIHdpbmRvdy5vbm1vdXNlZG93biA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY2xpY2sgb3V0c2lkZVwiKTtcbiAgICAgICAgICAgICAgICB3aW5kb3cub25tb3VzZWRvd24gPSBudWxsO1xuICAgICAgICAgICAgICAgIHNtYXNoLmNsYXNzLnJlbW92ZShzZWxlY3QsICdpcy1mb2N1c3NlZCcpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgIH1cbn07XG4iLCJzbWFzaC5yb3V0ZXIgPSB7XG4gICAgX19wYXJzZVJvdXRlUmVnZXg6IC97KC4qPyl9L2lnLFxuICAgIF9fZHluYW1pY1BhcnRzOiBbXSxcbiAgICBfX3JvdXRlczoge1xuICAgICAgICBzdGF0aWM6IFtdLFxuICAgICAgICBkeW5hbWljOiBbXVxuICAgIH1cbn07XG5cbnNtYXNoLnJvdXRlci5hZGQgPSBmdW5jdGlvbihwYXRoLCBjYWxsYmFjaykge1xuICAgIHZhciByb3V0ZSA9IHNtYXNoLnJvdXRlci5wYXJzZVJvdXRlKHBhdGgpO1xuICAgIGlmIChyb3V0ZS5yZWdleCkge1xuICAgICAgICByb3V0ZS5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICBpZiAoIXNtYXNoLnJvdXRlci5fX3JvdXRlcy5keW5hbWljW3JvdXRlLmRlcHRoXSkge1xuICAgICAgICAgICAgc21hc2gucm91dGVyLl9fcm91dGVzLmR5bmFtaWNbcm91dGUuZGVwdGhdID0gW107XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzbWFzaC5yb3V0ZXIuX19yb3V0ZXMuZHluYW1pY1tyb3V0ZS5kZXB0aF1bcm91dGUubnVtVmFyc10pIHtcbiAgICAgICAgICAgIHNtYXNoLnJvdXRlci5fX3JvdXRlcy5keW5hbWljW3JvdXRlLmRlcHRoXVtyb3V0ZS5udW1WYXJzXSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHNtYXNoLnJvdXRlci5fX3JvdXRlcy5keW5hbWljW3JvdXRlLmRlcHRoXVtyb3V0ZS5udW1WYXJzXS5wdXNoKHJvdXRlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzbWFzaC5yb3V0ZXIuX19yb3V0ZXMuc3RhdGljW3BhdGhdID0gY2FsbGJhY2s7XG59O1xuXG5zbWFzaC5yb3V0ZXIuc2V0ID0gZnVuY3Rpb24ocm91dGUpIHtcbiAgICB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUoXCJcIiwgXCJcIiwgcm91dGUpO1xuICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgncG9wc3RhdGUnKSk7XG59O1xuXG5zbWFzaC5yb3V0ZXIucmVkaXJlY3QgPSBmdW5jdGlvbihyb3V0ZSkge1xuICAgIHdpbmRvdy5sb2NhdGlvbiA9IHJvdXRlO1xufTtcblxuc21hc2gucm91dGVyLmhhbmRsZU5vdEZvdW5kID0gZnVuY3Rpb24ocm91dGUpIHtcbiAgICBjb25zb2xlLmxvZyhcInJvdXRlOiBcIiArIEpTT04uc3RyaW5naWZ5KHJvdXRlKSArIFwiIGRvZXMgbm90IGV4aXN0XCIpO1xufTtcblxuc21hc2gucm91dGVyLnJ1biA9IGZ1bmN0aW9uKCkge1xuICAgIHdpbmRvdy5vbnBvcHN0YXRlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgc21hc2gucm91dGVyLmV4ZWN1dGUoKTtcbiAgICB9O1xuICAgIHNtYXNoLnJvdXRlci5leGVjdXRlKCk7XG59XG5cbnNtYXNoLnJvdXRlci5leGVjdXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBhdGggPSB0aGlzLmdldFBhdGgoKTtcbiAgICBpZiAodGhpcy5fX3JvdXRlcy5zdGF0aWNbcGF0aC5wYXRoXSkge1xuICAgICAgICB0aGlzLl9fcm91dGVzLnN0YXRpY1twYXRoLnBhdGhdKCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGRlcHRoID0gcGF0aC5wYXRoLnNwbGl0KFwiL1wiKS5sZW5ndGgtMTtcbiAgICBpZiAodGhpcy5fX3JvdXRlcy5keW5hbWljW2RlcHRoXSkge1xuICAgICAgICB2YXIgcm91dGU7XG4gICAgICAgIHZhciBtYXRjaGVzO1xuICAgICAgICB2YXIgZGF0YSA9IHt9O1xuICAgICAgICBmb3IgKHZhciB2YXJOdW0gaW4gdGhpcy5fX3JvdXRlcy5keW5hbWljW2RlcHRoXSkge1xuICAgICAgICAgICAgZm9yICh2YXIgaXRlbSBpbiB0aGlzLl9fcm91dGVzLmR5bmFtaWNbZGVwdGhdW3Zhck51bV0pIHtcbiAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSB0aGlzLl9fcm91dGVzLmR5bmFtaWNbZGVwdGhdW3Zhck51bV1baXRlbV07XG4gICAgICAgICAgICAgICAgbWF0Y2hlcyA9IHBhdGgucGF0aC5tYXRjaChyb3V0ZS5yZWdleCk7XG4gICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpPTA7IGk8cm91dGUubnVtVmFyczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbcm91dGUudmFyc1tpXV0gPSBtYXRjaGVzW2krMV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJvdXRlLmNhbGxiYWNrKGRhdGEpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBzbWFzaC5yb3V0ZXIuaGFuZGxlTm90Rm91bmQocGF0aCk7XG59O1xuXG5zbWFzaC5yb3V0ZXIuZ2V0UGF0aCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgbC5ocmVmID0gd2luZG93LmxvY2F0aW9uO1xuICAgIHJldHVybiB7aG9zdDogbC5ob3N0bmFtZSwgcGF0aDogbC5wYXRobmFtZX07XG59O1xuXG5zbWFzaC5yb3V0ZXIucGFyc2VSb3V0ZSA9IGZ1bmN0aW9uKHBhdGgpIHtcbiAgICBpZiAocGF0aC5zdWJzdHJpbmcoMCwxKSAhPSBcIi9cIikge1xuICAgICAgICBwYXRoID0gXCIvXCIgKyBwYXRoO1xuICAgIH1cbiAgICBpZiAocGF0aC5zdWJzdHJpbmcocGF0aC5sZW5ndGgtMikgPT0gXCIvXCIpIHtcbiAgICAgICAgcGF0aCA9IFwiL1wiICsgcGF0aDtcbiAgICB9XG4gICAgdmFyIHJvdXRlID0ge1xuICAgICAgICBwYXRoOiBwYXRoLFxuICAgICAgICBkZXB0aDogKHBhdGguc3BsaXQoXCIvXCIpLmxlbmd0aCAtIDEpLFxuICAgICAgICB2YXJzOiBbXSxcbiAgICAgICAgbnVtVmFyczogMFxuICAgIH07XG4gICAgc21hc2gucm91dGVyLl9fZHluYW1pY1BhcnRzID0gcGF0aC5tYXRjaChzbWFzaC5yb3V0ZXIuX19wYXJzZVJvdXRlUmVnZXgpO1xuICAgIGlmIChzbWFzaC5yb3V0ZXIuX19keW5hbWljUGFydHMgIT0gdW5kZWZpbmVkICYmIHNtYXNoLnJvdXRlci5fX2R5bmFtaWNQYXJ0cyAhPSBudWxsKSB7XG4gICAgICAgIHZhciByZWdleCA9IFwiXlwiICsgcGF0aC5yZXBsYWNlKC9cXC8vaWcsIFwiXFxcXC9cIikgKyBcIiRcIjtcbiAgICAgICAgZm9yICh2YXIgaT0wOyBpPHNtYXNoLnJvdXRlci5fX2R5bmFtaWNQYXJ0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgcm91dGUubnVtVmFycysrO1xuICAgICAgICAgICAgcm91dGUudmFycy5wdXNoKHNtYXNoLnJvdXRlci5fX2R5bmFtaWNQYXJ0c1tpXS5zdWJzdHJpbmcoMSwgc21hc2gucm91dGVyLl9fZHluYW1pY1BhcnRzW2ldLmxlbmd0aC0xKSk7XG4gICAgICAgICAgICByZWdleCA9IHJlZ2V4LnJlcGxhY2Uoc21hc2gucm91dGVyLl9fZHluYW1pY1BhcnRzW2ldLCBcIiguKj8pXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJvdXRlLnJlZ2V4ID0gbmV3IFJlZ0V4cChyZWdleCwgJ2knKTtcbiAgICB9XG4gICAgcmV0dXJuIHJvdXRlO1xufTtcbiIsInNtYXNoLnNlYXJjaGJveCA9IHtcbiAgICBpXzogZmFsc2Vcbn07XG5cbnNtYXNoLnNlYXJjaGJveC5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHNtYXNoLnNlYXJjaGJveC5pXykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBzc2IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNtYXNoLXNlYXJjaGJveCBpbnB1dFwiKTtcbiAgICBpZiAoc3NiKSB7XG4gICAgICAgIHNzYi5vbmZvY3VzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzbWFzaC5jbGFzcy5hZGQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbWFzaC1oZWFkZXJcIiksICdpcy1mb2N1c3NlZCcpO1xuICAgICAgICB9O1xuICAgICAgICBzc2Iub25ibHVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzbWFzaC5jbGFzcy5yZW1vdmUoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbWFzaC1oZWFkZXJcIiksICdpcy1mb2N1c3NlZCcpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBzbWFzaC5zZWFyY2hib3guaV8gPSB0cnVlO1xufTtcbiIsInNtYXNoLnNpZGViYXIgPSB7XG4gICAgaV86IGZhbHNlXG59O1xuXG5zbWFzaC5zaWRlYmFyLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoc21hc2guc2lkZWJhci5pXykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBzaWJsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbWFzaC1zaWRlYmFyIC5sb2NrXCIpO1xuICAgIGlmICghc2libCkge1xuICAgICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc2libC5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzbWFzaC5zaWRlYmFyLnRvZ2dsZUxvY2soKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgdmFyIHNpYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc21hc2gtc2lkZWJhclwiKTtcbiAgICBzbWFzaC5jbGFzcy5hZGQoc2liLCAnaXMtdW5sb2NrZWQnKTtcbiAgICBzbWFzaC5zaWRlYmFyLmlfID0gdHJ1ZTtcbiAgICBpZiAoc21hc2guY29uZmlnLmdldCgnc2lkZWJhcl9sb2NrJykpIHtcbiAgICAgICAgc21hc2guc2lkZWJhci50b2dnbGVMb2NrKCk7XG4gICAgfVxufTtcblxuc21hc2guc2lkZWJhci50b2dnbGVMb2NrID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCFzbWFzaC5zaWRlYmFyLmlfKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc21hc2guY2xhc3MudG9nZ2xlKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc21hc2gtc2lkZWJhciAubG9ja1wiKSwgJ3VubG9jaycpO1xuICAgIHNtYXNoLmNsYXNzLnRvZ2dsZShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNtYXNoLXNpZGViYXJcIiksICdpcy11bmxvY2tlZCcpO1xuICAgIHNtYXNoLmNvbmZpZy5zZXQoJ3NpZGViYXJfbG9jaycsICFzbWFzaC5jbGFzcy5oYXMoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbWFzaC1zaWRlYmFyXCIpLCAnaXMtdW5sb2NrZWQnKSk7XG59O1xuIiwic21hc2guc3RvcmFnZSA9IHt9O1xuXG5zbWFzaC5zdG9yYWdlLnNldCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0obmFtZSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbn07XG5cbnNtYXNoLnN0b3JhZ2UuZ2V0ID0gZnVuY3Rpb24obmFtZSkge1xuICAgIHZhciBpID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0obmFtZSk7XG4gICAgaWYgKCFpKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHJldHVybiBKU09OLnBhcnNlKGkpO1xufTtcblxuc21hc2guc3RvcmFnZS5jbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgIGxvY2FsU3RvcmFnZS5jbGVhcigpO1xufTtcbiIsInNtYXNoLndvcmtzcGFjZSA9IHtcbiAgICBfd3NfOiB1bmRlZmluZWQsXG4gICAgX2hkcl86IHVuZGVmaW5lZCxcbiAgICBfc2JfOiB1bmRlZmluZWQsXG4gICAgX3RhYnNfOiBbXVxufTtcblxuc21hc2gud29ya3NwYWNlLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICBzbWFzaC53b3Jrc3BhY2UuX3dzXyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc21hc2gtd29ya3NwYWNlXCIpO1xuICAgIGlmICghc21hc2gud29ya3NwYWNlLl93c18pIHtcbiAgICAgICAgcmV0dXJuXG4gICAgfVxuICAgIHNtYXNoLndvcmtzcGFjZS5faGRyXyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc21hc2gtaGVhZGVyXCIpO1xuICAgIGlmIChzbWFzaC53b3Jrc3BhY2UuX2hkcl8pIHtcbiAgICAgICAgc21hc2guY2xhc3MuYWRkKHNtYXNoLndvcmtzcGFjZS5fd3NfLCAnaGFzLWhlYWRlcicpO1xuICAgIH1cbiAgICBzbWFzaC53b3Jrc3BhY2UuX3NiXyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc21hc2gtd29ya3NwYWNlIC5zbWFzaC1zaWRlYmFyXCIpO1xuICAgIGlmIChzbWFzaC53b3Jrc3BhY2UuX3NiXykge1xuICAgICAgICBzbWFzaC5jbGFzcy5hZGQoc21hc2gud29ya3NwYWNlLl93c18sICdoYXMtc2lkZWJhcicpO1xuICAgIH1cbn07XG5cbnNtYXNoLndvcmtzcGFjZS5hZGRUYWIgPSBmdW5jdGlvbihpZCwgdGl0bGUsIGNvbnRlbnQpIHtcbiAgICBpZiAoIXNtYXNoLmdldChkb2N1bWVudCwgJy5zbWFzaC10YWItcGFuZScpKSB7XG4gICAgICAgIHZhciBwYW5lbCA9IHNtYXNoLmdldChkb2N1bWVudCwgJy5zbWFzaC1wYW5lbCcpO1xuICAgICAgICBpZiAoIXBhbmVsKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVG8gYWRkIGEgdGFiIHRoZXJlIG5lZWRzIHRvIGJlIGEgcGFuZWwnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBwYW5lbC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz1cInNtYXNoLXRhYi1wYW5lXCI+PGRpdiBjbGFzcz1cInNtYXNoLXRhYnNcIj48L2Rpdj48ZGl2IGNsYXNzPVwic21hc2gtcGFuZXNcIj48L2Rpdj48L2Rpdj4nO1xuICAgIH1cbiAgICB2YXIgdGFicyA9IHNtYXNoLmdldChkb2N1bWVudCwgJy5zbWFzaC10YWItcGFuZSAuc21hc2gtdGFicycpO1xuICAgIHZhciBwYW5lc0NvbnRhaW5lciA9IHNtYXNoLmdldChkb2N1bWVudCwgJy5zbWFzaC10YWItcGFuZSAuc21hc2gtcGFuZXMnKTtcblxuICAgIHNtYXNoLmhpZGUocGFuZXNDb250YWluZXIsIFwiLnNtYXNoLXBhbmVcIik7XG4gICAgaWYgKGFjdGl2ZSA9IHNtYXNoLmdldCh0YWJzLCAnLnNtYXNoLXRhYi5hY3RpdmUnKSkge1xuICAgICAgICBzbWFzaC5jbGFzcy5yZW1vdmUoYWN0aXZlLCAnYWN0aXZlJyk7XG4gICAgfVxuICAgIHRhYnMuaW5uZXJIVE1MID0gdGFicy5pbm5lckhUTUwgKyAnPGRpdiBjbGFzcz1cInNtYXNoLXRhYiBhY3RpdmVcIiBkYXRhLWlkPVwiJyArIGlkICsgJ1wiPicgKyB0aXRsZSArICc8aSBjbGFzcz1cIm1hdGVyaWFsLWljb25zIGNsb3NlXCI+Y2xvc2U8L2k+PC9kaXY+JztcbiAgICBwYW5lc0NvbnRhaW5lci5pbm5lckhUTUwgPSBwYW5lc0NvbnRhaW5lci5pbm5lckhUTUwgKyAnPGRpdiBjbGFzcz1cInNtYXNoLXBhbmVcIiBkYXRhLWlkPVwiJyArIGlkICsgJ1wiPicgKyBjb250ZW50ICsgJzwvZGl2Pic7XG4gICAgc21hc2gub24odGFicywgJy5zbWFzaC10YWInLCAnb25jbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3Rlc3QnKTtcbiAgICAgICAgaWYgKGFjdGl2ZSA9IHNtYXNoLmdldCh0YWJzLCAnLnNtYXNoLXRhYi5hY3RpdmUnKSkge1xuICAgICAgICAgICAgc21hc2guY2xhc3MucmVtb3ZlKGFjdGl2ZSwgJ2FjdGl2ZScpO1xuICAgICAgICB9XG4gICAgICAgIHNtYXNoLmNsYXNzLmFkZCh0aGlzLCAnYWN0aXZlJyk7XG4gICAgfSk7XG59O1xuIl19
